(()=>{"use strict";const e=document.getElementById("deals-container"),t=document.getElementById("popup");let i=null;const n=e=>new Promise((t=>setTimeout(t,e)));(async function(){return await async function(){const e=await fetch("https://anasstya.amocrm.ru/api/v4/leads",{method:"GET",headers:{Authorization:"Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjQzMzBjNTJmZDlmMTk0YjFiYzUxMWZjY2ViOTZlZjcwODI4ZDFhNmEzMzk5YjMwMzljZDc2MTgwYTg1ZTlkOWE2MTYxOThmMmMxYzZmMGE5In0.eyJhdWQiOiJhZjFjY2M4OC0xZjY2LTQ2NGYtYWE5MC00YmJkY2FjYTBlZDkiLCJqdGkiOiI0MzMwYzUyZmQ5ZjE5NGIxYmM1MTFmY2NlYjk2ZWY3MDgyOGQxYTZhMzM5OWIzMDM5Y2Q3NjE4MGE4NWU5ZDlhNjE2MTk4ZjJjMWM2ZjBhOSIsImlhdCI6MTcyNzc3MDczMywibmJmIjoxNzI3NzcwNzMzLCJleHAiOjE3MjkyOTYwMDAsInN1YiI6IjExNTg3MzYyIiwiZ3JhbnRfdHlwZSI6IiIsImFjY291bnRfaWQiOjMxOTgxNjE0LCJiYXNlX2RvbWFpbiI6ImFtb2NybS5ydSIsInZlcnNpb24iOjIsInNjb3BlcyI6WyJjcm0iLCJmaWxlcyIsImZpbGVzX2RlbGV0ZSIsIm5vdGlmaWNhdGlvbnMiLCJwdXNoX25vdGlmaWNhdGlvbnMiXSwiaGFzaF91dWlkIjoiZmE0OGJhMWEtODFlMi00Njg3LTk2NzgtZmQxNjMzZmU0ZTM2IiwiYXBpX2RvbWFpbiI6ImFwaS1iLmFtb2NybS5ydSJ9.SFGURMmy3gUn5GFXm4koHemtNOe0tfo7H90LtyVKJRi_L1SbIwu5kfnUeY4d0cElhTcML7WJt4nmG3hc4lvbE6qX5jYjMBqVdJr9oTCpFIqlEjxsQv3zcgibu0poQWrnDuZ8B-OPXvRoclUOT21-UAiwu62bjM3AUG-Q8qUuDLU8Cugzz3_la2Xuxsz2VhWrDKMaRZ1pKJEQLciJc_vCpZW3UFLrI2jwLN1iAkkEjthToIs0JwGeVr0HFOVoMX2d39YIO8dinbToT8YXDTXnlahiAkhs2OfAYMSHqcTQsMdXRMKovS-fcrNuitPgNj6vNi7BSGqecpd7Og9P3Q8nEA","Content-Type":"application/json"}});if(e.ok){const t=await e.json();if(t._embedded&&t._embedded.leads){const e=t._embedded.leads,i={};return e.forEach((e=>{i[e.id]={name:e.name,price:e.price,responsible_user_id:e.responsible_user_id,status_id:e.status_id,created_at:e.created_at,updated_at:e.updated_at,closed:e.closest_task_at}})),i}}}()})().then((async d=>{const a=Object.entries(d);for(let d=0;d<a.length;d++){let s=a[d][1].updated_at,l=new Date(1e3*s),c=`${String(l.getDate()).padStart(2,"0")}.${String(l.getMonth()+1).padStart(2,"0")}.${l.getFullYear()}`,o=a[d][1].closed,r=new Date(1e3*o),m=new Date,M="";r.getDate()===m.getDate()&&(M="green"),r.getDate()<m.getDate()&&(M="red"),r.getDate()>m.getDate()&&(M="yellow");let p=`<svg width="10" height="10" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n        <circle cx="10" cy="10" r="10" fill="${M}" />\n    </svg>`;const I=document.createElement("tr");I.innerHTML=`<td>${a[d][0]}</td><td>${a[d][1].name}</td><td>${a[d][1].price}</td>`,e.appendChild(I),I.addEventListener("click",(()=>{null!==i&&(t.classList.add("hidden"),t.innerHTML=""),I.innerHTML='<div class="spinner" role="status"><div class="animation"></div><span class="visually-hidden">Загрузка...</span></div>',setTimeout((()=>{t.classList.contains("hidden")&&(I.innerHTML=`<td>${a[d][0]}</td><td>${a[d][1].name}</td><td>${a[d][1].price}</td>`,t.classList.remove("hidden"),i=d,t.innerHTML=`<div class="popup__name">Название: ${a[d][1].name}</div>\n                                       <div class="popup__text">ID: ${a[d][0]}</div>\n                                       <div class="popup__text">Дата: ${c}</div>\n                                       <div>Статус: ${p}</div>\n                                       <button class="popup-btn" id="btn">Закрыть</button>`,document.getElementById("btn").addEventListener("click",(()=>{t.classList.add("hidden"),t.innerHTML="",i=null})))}),500)})),(d+1)%3==0&&await n(3e3)}})).catch((e=>{console.error("Ошибка при получении данных:",e)}))})();